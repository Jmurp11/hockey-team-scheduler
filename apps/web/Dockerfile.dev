# Development Dockerfile for Angular UI (Dockerfile inside apps/web/)
FROM node:20-alpine AS dev

WORKDIR /app

RUN apk add --no-cache libc6-compat

# Copy root-level configs for caching
COPY package*.json nx.json tsconfig.base.json ./
COPY jest.config.js jest.preset.js ./

# Install dependencies
RUN npm ci --prefer-offline --no-audit

# Copy source (libs + app only)
COPY libs ./libs
COPY apps/web ./apps/web

EXPOSE 4200

CMD ["npx", "nx", "serve", "web"]